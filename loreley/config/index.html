<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Configuration - Loreley</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/fontawesome.min.css" rel="stylesheet">
        <link href="../../css/brands.min.css" rel="stylesheet">
        <link href="../../css/solid.min.css" rel="stylesheet">
        <link href="../../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">Loreley</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href="../.." class="nav-link">Home</a>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle active" aria-current="page" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Loreley</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="./" class="dropdown-item active" aria-current="page">Configuration</a>
</li>
                                    
<li>
    <a href="../core/experiments/" class="dropdown-item">Experiments</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Scheduler</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../scheduler/main/" class="dropdown-item">Overview</a>
</li>
            
<li>
    <a href="../scheduler/job_scheduler/" class="dropdown-item">Job scheduling</a>
</li>
            
<li>
    <a href="../scheduler/ingestion/" class="dropdown-item">Ingestion</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Database</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../db/base/" class="dropdown-item">Engine & sessions</a>
</li>
            
<li>
    <a href="../db/models/" class="dropdown-item">Models</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">MAP-Elites</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../core/map-elites/map-elites/" class="dropdown-item">Overview</a>
</li>
            
<li>
    <a href="../core/map-elites/preprocess/" class="dropdown-item">Preprocessing</a>
</li>
            
<li>
    <a href="../core/map-elites/chunk/" class="dropdown-item">Chunking</a>
</li>
            
<li>
    <a href="../core/map-elites/code_embedding/" class="dropdown-item">Code embeddings</a>
</li>
            
<li>
    <a href="../core/map-elites/dimension_reduction/" class="dropdown-item">Dimensionality reduction</a>
</li>
            
<li>
    <a href="../core/map-elites/sampler/" class="dropdown-item">Sampler</a>
</li>
            
<li>
    <a href="../core/map-elites/snapshot/" class="dropdown-item">Snapshots</a>
</li>
            
<li>
    <a href="../core/map-elites/summarization_embedding/" class="dropdown-item">Summary embeddings</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Worker pipeline</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../core/worker/repository/" class="dropdown-item">Repository</a>
</li>
            
<li>
    <a href="../core/worker/planning/" class="dropdown-item">Planning</a>
</li>
            
<li>
    <a href="../core/worker/agent_backend/" class="dropdown-item">Agent backend</a>
</li>
            
<li>
    <a href="../core/worker/coding/" class="dropdown-item">Coding</a>
</li>
            
<li>
    <a href="../core/worker/evaluator/" class="dropdown-item">Evaluation</a>
</li>
            
<li>
    <a href="../core/worker/evolution/" class="dropdown-item">Evolution loop</a>
</li>
            
<li>
    <a href="../core/worker/commit_summary/" class="dropdown-item">Commit summaries</a>
</li>
            
<li>
    <a href="../core/worker/job_store/" class="dropdown-item">Job store</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Tasks</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../tasks/broker/" class="dropdown-item">Broker</a>
</li>
            
<li>
    <a href="../tasks/workers/" class="dropdown-item">Workers</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Operations</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../script/run_scheduler/" class="dropdown-item">Running the scheduler</a>
</li>
                                    
<li>
    <a href="../../script/run_worker/" class="dropdown-item">Running the worker</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../.." class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../core/experiments/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#loreleyconfig" class="nav-link">loreley.config</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#settings" class="nav-link">Settings</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#access-helpers" class="nav-link">Access helpers</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="loreleyconfig">loreley.config<a class="headerlink" href="#loreleyconfig" title="Permanent link">&para;</a></h1>
<p>Centralised configuration for the Loreley application, backed by <code>pydantic-settings</code> and environment variables.</p>
<h2 id="settings">Settings<a class="headerlink" href="#settings" title="Permanent link">&para;</a></h2>
<ul>
<li><strong><code>Settings</code></strong>: <code>BaseSettings</code> subclass that loads core application configuration.</li>
<li><strong>Environment</strong>: <code>app_name</code>, <code>environment</code>, <code>log_level</code>, <code>logs_base_dir</code>. <code>log_level</code> controls the global Loguru log level used across long-running processes (including the scheduler, workers, and their CLI wrappers); <code>logs_base_dir</code> (via <code>LOGS_BASE_DIR</code>) optionally overrides the base directory where long-running process logs are written, defaulting to a <code>logs/</code> directory under the current working directory. See the scripts documentation under <code>docs/script</code> for concrete examples.</li>
<li><strong>OpenAI-compatible API</strong>: <code>OPENAI_API_KEY</code>, <code>OPENAI_BASE_URL</code>, <code>OPENAI_API_SPEC</code> configure the API key, base URL, and API surface for all OpenAI-compatible LLM and embedding calls, used by <code>loreley.core.map-elites.code_embedding.CodeEmbedder</code>, <code>loreley.core.map-elites.summarization_embedding.SummaryEmbedder</code>, and <code>loreley.core.worker.commit_summary.CommitSummarizer</code>. When unset, <code>OPENAI_API_KEY</code>/<code>OPENAI_BASE_URL</code> fall back to the OpenAI Python client's own environment variable defaults. <code>OPENAI_API_SPEC</code> accepts:<ul>
<li><code>"responses"</code> (default): use the unified <code>responses</code> API (<code>client.responses.create</code>) for text generation.</li>
<li><code>"chat_completions"</code>: use the classic Chat Completions API (<code>client.chat.completions.create</code>) while preserving the same high-level behaviour.</li>
</ul>
</li>
<li><strong>Database</strong>: either a raw <code>DATABASE_URL</code> or individual <code>DB_*</code> fields (scheme, host, port, username, password, database name, pool options, echo flag).</li>
<li><strong>Metrics</strong>: <code>metrics_retention_days</code> controls how long metrics are retained.</li>
<li><strong>Task queue</strong>: <code>TASKS_REDIS_URL</code>, <code>TASKS_REDIS_HOST</code>, <code>TASKS_REDIS_PORT</code>, <code>TASKS_REDIS_DB</code>, <code>TASKS_REDIS_PASSWORD</code>, <code>TASKS_REDIS_NAMESPACE</code>, <code>TASKS_QUEUE_NAME</code>, <code>TASKS_WORKER_MAX_RETRIES</code>, and <code>TASKS_WORKER_TIME_LIMIT_SECONDS</code> configure the Dramatiq Redis broker connection details, logical namespace, queue routing, retry policy, and actor time limits used by <code>loreley.tasks.broker</code> and <code>loreley.tasks.workers</code>. When <code>TASKS_REDIS_URL</code> is set and includes credentials, only a sanitised <code>scheme://host:port/db</code> form is logged, never the raw URL or password. <code>TASKS_WORKER_TIME_LIMIT_SECONDS</code> is interpreted in seconds and converted to Dramatiq's millisecond <code>time_limit</code>: values <code>&lt;= 0</code> disable the time limit (no hard cap on actor runtime), while positive values enforce a per-job wall-clock limit.</li>
<li><strong>Scheduler</strong>: <code>SCHEDULER_REPO_ROOT</code>, <code>SCHEDULER_POLL_INTERVAL_SECONDS</code>, <code>SCHEDULER_MAX_UNFINISHED_JOBS</code>, <code>SCHEDULER_SCHEDULE_BATCH_SIZE</code>, <code>SCHEDULER_DISPATCH_BATCH_SIZE</code>, and <code>SCHEDULER_INGEST_BATCH_SIZE</code> drive <code>loreley.scheduler.main</code>. These options determine which git worktree the scheduler inspects, how often it runs a reconciliation tick, how many unfinished jobs are allowed at once, how aggressively it samples new MAP-Elites jobs per tick, how many pending jobs are dispatched to Dramatiq each cycle, and how many completed jobs are ingested back into the archive per tick.</li>
<li><strong>Worker repository</strong>: <code>WORKER_REPO_REMOTE_URL</code>, <code>WORKER_REPO_BRANCH</code>, <code>WORKER_REPO_WORKTREE</code>, <code>WORKER_REPO_GIT_BIN</code>, <code>WORKER_REPO_FETCH_DEPTH</code>, <code>WORKER_REPO_CLEAN_EXCLUDES</code>, <code>WORKER_REPO_JOB_BRANCH_PREFIX</code>, <code>WORKER_REPO_ENABLE_LFS</code>, and <code>WORKER_REPO_JOB_BRANCH_TTL_HOURS</code> configure the git worktree used by worker processes (upstream remote and branch, local checkout path, git binary, shallow clone depth, clean exclusions, job branch naming, optional Git LFS support, and how long remote job branches are retained before pruning), used by <code>loreley.core.worker.repository.WorkerRepository</code>.</li>
<li><strong>Worker planning</strong>: <code>WORKER_PLANNING_*</code> options configuring how the external Codex CLI planner is invoked (binary path, optional profile, maximum attempts, timeout, extra environment variables, and an optional JSON schema override), used by <code>loreley.core.worker.planning.PlanningAgent</code>.</li>
<li><strong>Worker coding</strong>: <code>WORKER_CODING_*</code> options configuring how the external Codex-based coding agent is invoked (binary path, optional profile, maximum attempts, timeout, extra environment variables, and an optional JSON schema override), used by <code>loreley.core.worker.coding.CodingAgent</code>.</li>
<li><strong>Worker evaluator</strong>: <code>WORKER_EVALUATOR_PLUGIN</code>, <code>WORKER_EVALUATOR_PYTHON_PATHS</code>, <code>WORKER_EVALUATOR_TIMEOUT_SECONDS</code>, and <code>WORKER_EVALUATOR_MAX_METRICS</code> configure the evaluation plugin entry point, additional Python paths, subprocess timeout, and the maximum number of metrics to keep, used by <code>loreley.core.worker.evaluator.Evaluator</code>.</li>
<li><strong>Worker evolution commits</strong>: <code>WORKER_EVOLUTION_COMMIT_MODEL</code>, <code>WORKER_EVOLUTION_COMMIT_TEMPERATURE</code>, <code>WORKER_EVOLUTION_COMMIT_MAX_OUTPUT_TOKENS</code>, <code>WORKER_EVOLUTION_COMMIT_MAX_RETRIES</code>, <code>WORKER_EVOLUTION_COMMIT_RETRY_BACKOFF_SECONDS</code>, <code>WORKER_EVOLUTION_COMMIT_AUTHOR</code>, <code>WORKER_EVOLUTION_COMMIT_EMAIL</code>, and <code>WORKER_EVOLUTION_COMMIT_SUBJECT_MAX_CHARS</code> configure how the evolution worker generates and records commit subjects (LLM model, sampling behaviour, retry policy, and subject length) and which author identity is used when creating commits, used by <code>loreley.core.worker.commit_summary.CommitSummarizer</code> and <code>loreley.core.worker.repository.WorkerRepository</code>.</li>
<li><strong>Worker evolution global goal</strong>: <code>WORKER_EVOLUTION_GLOBAL_GOAL</code> provides a single, plain‑language evolution objective that is shared across all jobs. When no per‑job <code>goal</code>/<code>objective</code>/<code>description</code> is present in the job payload, this value is used as the <strong>Global objective</strong> in both the planning and coding prompts so that the worker consistently optimises towards a user‑defined high‑level target.</li>
<li><strong>Map-Elites preprocessing</strong>: <code>MAPELITES_PREPROCESS_*</code> options controlling which changed code files are considered for feature extraction (limits on file count/size, allowed extensions/filenames, excluded path globs, whitespace handling, and comment stripping), used by <code>loreley.core.map-elites.preprocess.CodePreprocessor</code>.</li>
<li><strong>Map-Elites chunking</strong>: <code>MAPELITES_CHUNK_*</code> options controlling how preprocessed files are split into chunks (target and minimum lines per chunk, overlap, maximum chunks per file, and boundary keywords used by the chunker), used by <code>loreley.core.map-elites.chunk.CodeChunker</code>.</li>
<li><strong>Map-Elites code embedding</strong>: <code>MAPELITES_CODE_EMBEDDING_*</code> options configuring the embedding model, optional output dimensions, batch size, per-commit chunk budget, retry count, and exponential backoff for embedding requests, used by <code>loreley.core.map-elites.code_embedding.CodeEmbedder</code>.</li>
<li><strong>Map-Elites summary embedding</strong>: <code>MAPELITES_SUMMARY_*</code> and <code>MAPELITES_SUMMARY_EMBEDDING_*</code> options configuring the LLM summary model (name, temperature, max output tokens, source excerpt character limit, retries, and backoff) and the summary embedding model (name, dimensions, and batch size), used by <code>loreley.core.map-elites.summarization_embedding.SummaryEmbedder</code>.</li>
<li><strong>Map-Elites dimensionality reduction</strong>: <code>MAPELITES_DIMENSION_REDUCTION_*</code> options controlling how penultimate code/summary embeddings are normalised, the target feature dimensions, minimum sample count for fitting PCA, rolling history size, and refit cadence, used by <code>loreley.core.map-elites.dimension_reduction.DimensionReducer</code>.</li>
<li><strong>Map-Elites feature bounds and archive</strong>: <code>MAPELITES_FEATURE_*</code> and <code>MAPELITES_ARCHIVE_*</code> options defining the search space for behaviour features (lower/upper bounds) and the grid resolution and learning parameters for the underlying MAP-Elites archive, used by <code>loreley.core.map-elites.map-elites.MapElitesManager</code>.</li>
<li><strong>Map-Elites fitness and sampling</strong>: <code>MAPELITES_FITNESS_*</code> and <code>MAPELITES_SAMPLER_*</code> options that configure which metric to optimise, how to treat fitness direction/floor, and how new jobs are drawn from the archive (inspiration count, neighbour radius, fallback sampling, default priority, and whether to include metadata), used by <code>loreley.core.map-elites.map-elites.MapElitesManager</code> and <code>loreley.core.map-elites.sampler.MapElitesSampler</code>.</li>
<li><strong>Map-Elites experiment root commit</strong>: <code>MAPELITES_EXPERIMENT_ROOT_COMMIT</code> optionally pins a specific git commit hash as the logical root for a given experiment. When set, the scheduler ensures this commit is recorded in the <code>commits</code> table and ingested into each relevant MAP-Elites island archive before scheduling any evolution jobs, so all subsequent jobs branch from a well-defined starting point.</li>
<li><strong><code>database_dsn</code></strong>: computed property that returns a SQLAlchemy-compatible DSN, preferring <code>DATABASE_URL</code> when set and otherwise building one from the individual DB fields (with credentials URL-encoded).</li>
<li><strong><code>export_safe()</code></strong>: helper that returns a dict of non-sensitive configuration values suitable for logging.</li>
</ul>
<h2 id="access-helpers">Access helpers<a class="headerlink" href="#access-helpers" title="Permanent link">&para;</a></h2>
<ul>
<li><strong><code>get_settings()</code></strong>: cached factory that instantiates <code>Settings</code>, logs a concise summary of the environment and DB host using <code>rich</code>/<code>loguru</code>, and returns a singleton instance for reuse across the loreley.</li>
</ul></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js"></script>
        <script src="../../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
